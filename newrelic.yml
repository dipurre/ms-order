# New Relic Java Agent Configuration
# Documentation: https://docs.newrelic.com/docs/agents/java-agent/configuration/java-agent-configuration-config-file

common: &default_settings
  license_key: '<%= license_key %>'
  app_name: ms-order
  
  # Distributed Tracing
  distributed_tracing:
    enabled: true
  
  # Application Logging
  application_logging:
    # IMPORTANTE: El forwarding automático captura logs ANTES de la ofuscación
    # Por eso lo desactivamos y usamos nuestro propio mecanismo con NewRelicEncoder
    enabled: true
    forwarding:
      # DESACTIVADO: Captura logs SIN ofuscar, no podemos usarlo
      # Los logs se envían a través del NewRelicEncoder con ofuscación
      enabled: false
      max_samples_stored: 10000
    local_decorating:
      # ACTIVADO: Agrega trace.id y span.id a los logs para correlación
      enabled: true
    metrics:
      enabled: true

  # Labels
  labels:
    team: backend
    service: diegoip_ms-order
  
  # Error Collector
  error_collector:
    enabled: true
    ignore_status_codes: 404
  
  # Transaction Tracer
  transaction_tracer:
    enabled: true
    transaction_threshold: apdex_f
    record_sql: obfuscated
    stack_trace_threshold: 0.5
  
  # Thread Profiler
  thread_profiler:
    enabled: true

prod:
  <<: *default_settings

dev:
  <<: *default_settings
  app_name: ms-order[dev]
  
qa:
  <<: *default_settings
  app_name: ms-order[qa]
